import pyautogui

# объявляем переменные:
name_X = None              # Ожидание ввода имени первого игрока.
name_0 = None              # Ожидание ввода имени второго игрока.
p1 = '\033[31mХ\033[0m'    # Игрок Х красный цвет
p2 = '\033[34mO\033[0m'    # Игрок O синий цвет


# Приветствие и правила игры:
def regulations():
    print()
    print('*' * 10, '\033[32m  Крестики - Нолики  \033[0m', '*' * 10)       # Добавим немного красок.
    print('         Добро пожаловать друзья !')
    print()

    decision = input('Хотите прочитать правила?: ').lower()                 # Ввод приводим к малому регистру.
    while decision != 'да' and decision != 'нет':                           # Проверка на корректность ответа.
        print('Введите корректный ответ ДА или НЕТ')
        decision = input('Хотите прочитать правила?: ').lower()
    if decision == 'да':
        res = pyautogui.confirm(text='* Игроки по очереди делают ход на свободные клетки поля.\n'
                                     '* Задача первым выставить 3 свои фишки по вертикали, горизонтали или диагонали.\n'
                                     '* Первый ход делает игрок, расставляющий крестик.\n'
                                     '* Для хода, необходимо ввести координаты поля, X и Y\n'
                                     '* Координаты вводятся через пробел (пример: 0 2)\n'
                                     '** 1 вводим X - это строка\n'
                                     '** 2 вводим Y - это столбец\n',
                                title='Правила игры «Крестики-нолики»',
                                buttons=['Начнем игру', 'В другой раз'])      # Вызов модального окна
        if res == 'В другой раз':                                             # В случае отказа от игры.
            print()
            print('Очень жаль, что вы передумали.\n''До новых встреч.')
            exit()                                                            # Завершаем работу программы
    elif decision == 'нет':
        print('Тогда начнем!')
        print()


# Знакомство с игроками:
def greet():
    global name_X, name_0                     # Данные переменные будут использоваться в нескольких функциях
    print('*' * 43)
    print()
    name_X = input('Введите имя игрока 1: ')
    print(f'{name_X}, ты крестик {p1}')
    print()
    name_0 = input('Введите имя игрока 2: ')
    print(f'{name_0}, ты нолик {p2}')
    print()
    print('*' * 43)


# Игровое поле:
def show():
    print()
    print('  | 0 | 1 | 2 | ')
    print('---------------- ')
    for i, row in enumerate(field):       # enumerate - берет список и пронумеровывает каждый элемент и мы одновременно
        # получаем и индекс списка и его элемент
        row_str = f'{i} | {" | ".join(row)} | '
        print(row_str)
        print('---------------- ')
    print()


# Запрос координат:
def ask():
    while True:  # бесконечный цикл, условие для выхода: пока не получим корректные координаты
        cords = input('Ваш ход: ').split()  # запрос координат и (.split()) их разбивает на отдельные координаты

        if len(cords) != 2:  # проверка на то, что введено именно 2 координаты
            print('Введите 2 координаты! ')
            continue

        i, j = cords  # присвоение координат

        if not (i.isdigit()) or not (j.isdigit()):  # проверка на ввод чисел
            print('Введите числа! ')
            continue

        i, j = int(i), int(j)  # перевод координат к типу "целые числа"

        if 0 > i or i > 2 or 0 > j or j > 2:  # проверка, что (i) и (j) лежат в заданном диапазоне
            print('Координаты вне диапазона! ')
            continue

        if field[i][j] != ' ':  # проверка на то, что поле свободное
            print('Клетка занята! ')
            continue
        return i, j  # возврат координат в функцию (это есть условие для выхода из бесконечного цикла)


# Проверка выигрышных комбинаций:
def check_win():
    win_cord = [((0, 0), (0, 1), (0, 2)), ((1, 0), (1, 1), (1, 2)), ((2, 0), (2, 1), (2, 2)),  # выигрышные строки
                ((0, 0), (1, 0), (2, 0)), ((0, 1), (1, 1), (2, 1)), ((0, 2), (1, 2), (2, 2)),  # выигрышные столбцы
                ((0, 0), (1, 1), (2, 2)), ((2, 0), (1, 1), (0, 2))]  # выигрышные диагонали
    for cord in win_cord:  # пройдемся по списку выигрышных комбинаций win_cord
        symbols = []
        for c in cord:  # пройдемся по списку каждой комбинации cord и сравним содержимое в каждой комбинации её точки
            symbols.append(field[c[0]][c[1]])  # добавим каждую комбинацию с её точками в новый список
            if symbols == [p1, p1, p1]:  # Если новый список состоит из трех X, то он победил
                print()
                print(f'Выиграл {p1}, Поздравляем {name_X} !!!')
                return True
            if symbols == [p2, p2, p2]:  # Если новый список состоит из трех 0, то он победил
                print()
                print(f'Выиграл {p2}, Поздравляем {name_0} !!!')
                return True
    return False


regulations()                             # Вызываем приветствие и правила игры
greet()                                   # Вызываем приветствие
field = [[' '] * 3 for i in range(3)]     # Созданное поле
num = 0                                   # Подсчет ходов, нечетное = ходит Х, четное = ходит 0
while True:                         # Бесконечный цикл, условие для выхода: пока не случится выигрыш или ничья (9 ходов)
    num += 1                        # Каждый ход, увеличиваем num на + 1
    show()                          # Вызов игрового поля

    if num % 2 == 1:                # Проверяем чей ход
        print('Ходит', name_X)
        move = p1                   # Если ходит крестик, то появляется X
    else:
        print('Ходит', name_0)
        move = p2                   # Если ходит нолик, то появляется 0

    i, j = ask()                    # После проверки хода, запрашиваем координаты, через функцию ask()
    field[i][j] = move

    if check_win():                 # Обращение к функции проверки на выигрыш
        field[i][j] = move
        show()
        print('Приз победителю !!!')
        print('\u2603')             # Приз победителя
        break                       # Если случился выигрыш, завершаем игру

    if num == 9:                    # Проверка на НИЧЬЮ, если до 9 шагов ни кто не выиграл
        field[i][j] = move
        show()
        print('Ничья')
        break                       # Выход из цикла т.к. достигли максимального количества ходов
